{% extends "base.html" %}

{% block title %}Инвентаризация №{{ inventory.id }}{% endblock %}

{% block content %}
<h2>Инвентаризация №{{ inventory.id }}</h2>

<p>Введите фактическое количество для каждого товара. Разница будет рассчитана автоматически.</p>

<table class="inv-table">
    <tr>
        <th>Товар</th>
        <th>Ожидалось</th>
        <th>Факт</th>
        <th>Отклонение</th>
        <th>Действие</th>
    </tr>

    {% for it in items %}
    {% set diff = it.difference %}
    <tr class="
        {% if diff is not none %}
            {% if diff == 0 %} ok
            {% elif diff < 0 %} less
            {% else %} more
            {% endif %}
        {% endif %}
    ">
        <td>{{ it.item.name }}</td>
        <td>{{ it.expected_qty }}</td>
        <td>{{ it.actual_qty if it.actual_qty is not none else "-" }}</td>

        <td>
            {% if diff is none %}
                -
            {% else %}
                {% if diff == 0 %}
                    0
                {% elif diff < 0 %}
                    Недостача {{ diff }}
                {% else %}
                    Излишек +{{ diff }}
                {% endif %}
            {% endif %}
        </td>

        <td>
            <form method="post" action="/inventory/update/{{ it.id }}" class="inv-form">
                <input
                    type="number"
                    name="actual_qty"
                    min="0"
                    placeholder="Введите факт"
                    required
                    class="inv-input"
                >
                <button type="submit" class="btn small">OK</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<a href="/home" class="btn back">Вернуться на главную</a>

<style>

/* Таблица */
.inv-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 16px;
}
.inv-table th, .inv-table td {
    border: 1px solid #ccc;
    padding: 12px 14px;
    text-align: center;
}

/* Цветовая индикация */
.inv-table tr.ok td {
    background: #e8ffe8; /* зелёный — совпадение */
}
.inv-table tr.less td {
    background: #ffe8e8; /* красный — недостача */
}
.inv-table tr.more td {
    background: #fff5cc; /* жёлтый — излишек */
}

/* Форма */
.inv-form {
    display: flex;
    gap: 10px;
    justify-content: center;
}

/* Увеличенное поле ввода */
.inv-input {
    width: 140px;
    padding: 10px 14px;
    font-size: 16px;
    border: 2px solid #888;
    border-radius: 6px;
}

/* Кнопки */
.btn.small {
    padding: 8px 14px;
    font-size: 14px;
}

.btn.back {
    display: inline-block;
    margin-top: 20px;
    padding: 10px 18px;
}

</style>

{% endblock %}
